###
# oaipmh
###
location /1.0/oaipmh {
    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_oaipmh::http_port') %>/oaipmh;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
}

###
# dhcrud
###
location /1.0/dhcrud {
    gzip on;
    gzip_types multipart/related application/xop+xml text/xml;
    client_max_body_size 5000m;
    proxy_read_timeout 900s;
    proxy_send_timeout 900s;
    proxy_connect_timeout 120s;
    proxy_pass http://localhost:<%= @tomcat_crud_http_port %>/dhcrud-public;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    # Workaround for CXF not setting GZIP content-length correctly.
    proxy_set_header Accept-Encoding "";
}

###
# dhpublish
###
location /1.0/dhpublish {
    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_publish::http_port') %>/dhpublish;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
}

###
# publikator
###
location /publikator {
    gzip on;
    gzip_types multipart/related application/xop+xml text/xml;
    client_max_body_size 5000m;
    proxy_read_timeout 900s;
    proxy_send_timeout 900s;
    proxy_connect_timeout 120s;
    # Nginx must relay to Apache because of Shibboleth authentication!
    proxy_pass http://localhost:8080/publikator;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
    # Workaround for CXF not setting GZIP content-length correctly.
    proxy_set_header Accept-Encoding "";
}

###
# shibboleth
###
location /Shibboleth.sso {
    proxy_pass http://127.0.0.1:8080/Shibboleth.sso;
}

###
# pid
###
# ONLY ACCESSED FROM INTERNAL!!
#location /1.0/pid {
#    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_pid::http_port') %>/dhpid;
#    proxy_set_header        X-Real-IP $remote_addr;
#    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
#    proxy_set_header        Host $http_host;
#}

###
# fits
###
# ONLY ACCESSED FROM INTERNAL!!
#location /fits {
#    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_fits::http_port') %>/fits;
#    proxy_set_header        X-Real-IP $remote_addr;
#    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
#    proxy_set_header        Host $http_host;
#}
