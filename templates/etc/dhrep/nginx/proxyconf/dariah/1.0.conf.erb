# locations for /

###
# oaipmh
###
location /oaipmh {
    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_oaipmh::http_port') %>/oaipmh;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
}

###
# dhcrud
###
location /dhcrud {
    gzip on;
    gzip_types multipart/related application/xop+xml text/xml;
    client_max_body_size 1000m;
    proxy_read_timeout 900s;
    proxy_send_timeout 900s;
    proxy_connect_timeout 120s;
    proxy_pass http://localhost:<%= @tomcat_crud_http_port %>/dhcrud-public;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
}

###
# dhpublish
###
# FIXME Only Publikator and publish API must have access!! Setup AAI!!
location /dhpublish {
    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_publish::http_port') %>/dhpublish;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
}

###
# publikator
###
# FIXME Take port from publikator's apache HTTP Port!! It's not working right now!!
location /publikator {
    proxy_pass http://localhost:8080/publikator;
#    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_publikator::http_port') %>/publikator;
    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        Host $http_host;
}
location /Shibboleth.sso {
    proxy_pass http://127.0.0.1:8080/Shibboleth.sso;
}

###
# pid
###
# Only accessed from internal!
#location /pid {
#    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_publish::http_port') %>/dhpid;
#    proxy_set_header        X-Real-IP $remote_addr;
#    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
#    proxy_set_header        Host $http_host;
#}

###
# fits
###
# Only accessed from internal!
#location /fits {
#    proxy_pass http://localhost:<%= scope.lookupvar('dhrep::services::tomcat_fits::http_port') %>/fits;
#    proxy_set_header        X-Real-IP $remote_addr;
#    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
#    proxy_set_header        Host $http_host;
#}
